<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="Bookmark" href="favicon.ico" >
	<link rel="Shortcut Icon" href="favicon.ico" />
	<!--[if lt IE 9]>
	<script type="text/javascript" src="lib/html5.js"></script>
	<script type="text/javascript" src="lib/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="__ADMINPUBLIC__/static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="__ADMINPUBLIC__/static/h-ui.admin.pro/css/h-ui.admin.pro.min.css" />
	<link rel="stylesheet" type="text/css" href="__ADMINPUBLIC__/lib/Hui-iconfont/1.0.9/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="__ADMINPUBLIC__/static/business/css/style.css" />
	<!--[if IE 6]>
	<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
	<script>DD_belatedPNG.fix('*');</script>
	<![endif]-->
	<!--/meta 作为公共模版分离出去-->

	<title>新增文章 - 资讯管理 </title>
</head>
<body>
	<article class="Hui-admin-page-container">
		<form class="form form-horizontal" id="form-article-add" enctype="multipart/form-data" action="" method="post">
			<div class="row clearfix">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>文章标题：</label>
				<div class="form-controls col-xs-8 col-sm-9">
					<input type="text" class="input-text" value="{$list['title']}"  href="{:url('/')}" placeholder="" id="articleTitle" name="articleTitle">
				</div>
			</div>
			<div class="row clearfix">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>分类栏目：</label>
				<div class="form-controls col-xs-8 col-sm-9">
					<span class="select-box">
						<select class="select" id="classifyID" name="articleClassify">
                            {volist name="tags" id="data"}
                             <option value="{$data.id}" {if condition="isset($list['p_id']) && $list['p_id'] eq  $data.e_id"}selected{else /}disabled{/if}>
                                {$data.tag_name}
							</option>
                            {/volist}
                        </select>
					</span>
				</div>
			</div>

			<div class="row clearfix">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>状态：</label>
				<div class="form-controls col-xs-8 col-sm-9">
					<span class="select-box">
						<select id="articlesStatus" name="articlesStatus" class="select">
							<option value="1">发布</option>
							<option value="2">下架</option>
						</select>
					</span>
				</div>
			</div>

			<div class="row clearfix">
				<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>文章摘要：</label>
				<div class="form-controls col-xs-8 col-sm-9">
					<textarea cols="" rows="" class="textarea textarea-article" id="articleAbstract" placeholder="说点什么...最少输入10个字符" name="articleAbstract">{$list['articleAbstract']}</textarea>
				</div>
			</div>

			<div class="row clearfix">
				<label class="form-label col-xs-4 col-sm-2">缩略图：</label>
				<div class="form-controls col-xs-8 col-sm-9">
					<span class="btn-upload">
						<a href="javascript:void();" class="btn btn-primary radius btn-upload"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
						<input type="file"  onchange='reads(this)' multiple name="btnUploadFileThumb" id="btn-upload-file-thumb" class="input-file">
					</span>
					<img id="backimg" style="width: 300px;height: 250px" class="picture-thumb" src="__ADMINIMG__/{$list.images}">

				</div>

			</div>
			<div class="row clearfix">
				<label class="form-label col-xs-4 col-sm-2">文章内容：</label>
				<div class="form-controls col-xs-8 col-sm-9">
					<script id="articleEditor" type="text/plain" style="width:100%;height:400px;"></script>
				</div>
			</div>
			<div class="row clearfix">
				<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
					<button class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 保存</button>
					<input type="hidden" name="id"  value="{$list.id}">
				</div>
			</div>
		</form>
	</article>

	<!--_footer 作为公共模版分离出去-->
	<script type="text/javascript" src="__ADMINPUBLIC__/lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="__ADMINPUBLIC__/lib/layer/3.1.1/layer.js"></script>
	<script type="text/javascript" src="__ADMINPUBLIC__/static/h-ui/js/H-ui.min.js"></script>
	<script type="text/javascript" src="__ADMINPUBLIC__/static/h-ui.admin.pro/js/h-ui.admin.pro.min.js"></script>
	<!--/_footer /作为公共模版分离出去-->

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="__ADMINPUBLIC__/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
	<script type="text/javascript" src="__ADMINPUBLIC__/lib/jquery.validation/1.14.0/validate-methods.js"></script>
	<script type="text/javascript" src="__ADMINPUBLIC__/lib/jquery.validation/1.14.0/messages_zh.js"></script>
	<script type="text/javascript" src="__ADMINPUBLIC__/lib/webuploader/0.1.5/webuploader.min.js"></script>
	<script type="text/javascript" src="__ADMINPUBLIC__/lib/ueditor/1.4.3/ueditor.config.js"></script>
	<script type="text/javascript" src="__ADMINPUBLIC__/lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
	<script type="text/javascript" src="__ADMINPUBLIC__/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
	<script type="text/javascript" src="__ADMINPUBLIC__/static/business/js/main.js"></script>
	<script type="text/javascript">

		function reads(obj) {
			    var file = obj.files[0];
			    var reader = new FileReader();
			    reader.readAsDataURL(file);
			    reader.onload = function(ev) {
			      $("#backimg").attr("src", ev.target.result);
			    }
		  	}

		$(function(){



			$("#articlesStatus").val({$list['statusifyID']});
			var strid="{$list['p_id']}";
			get_menu();
			function get_menu(){
				$.ajax({
                        url:"{:url('Article/get_menu')}",
                        type:'POST',
                        dataType:'JSON',
                        data:{id:$("#classifyID").val()},
                        success:function(data){
                            if (data.code==200) {
                                $('#statusifyIDs').empty();
                                $("#statusifyIDs").prepend("<option value='0'>请选择</option>");
                                $.each(data.data,function(i,item){
                                	if (strid  == item.id) {
                                		$('#statusifyIDs').append("<option value="+item.id+" selected>"+item.tag_name+"</option>");
                                	}else{
                                		$('#statusifyIDs').append("<option value="+item.id+">"+item.tag_name+"</option>");
                                	}

                                })
                            }else{
                                 $('#statusifyIDs').empty();
                                 $("#statusifyIDs").prepend("<option value='0'>请选择</option>");
                            }
                        }
                    })
			}

			$("#classifyID").change(function(){
                if ($(this).val() >0) {
                    $.ajax({
                        url:"{:url('Article/get_menu')}",
                        type:'POST',
                        dataType:'JSON',
                        data:{id:$(this).val()},
                        success:function(data){
                            if (data.code==200) {
                                $('#statusifyIDs').empty();
                                $("#statusifyIDs").prepend("<option value='0'>请选择</option>");
                                $.each(data.data,function(i,item){

                                    $('#statusifyIDs').append("<option value="+item.id+">"+item.tag_name+"</option>");
                                })
                            }else{
                                 $('#statusifyIDs').empty();
                                 $("#statusifyIDs").prepend("<option value='0'>请选择</option>");
                            }
                        }
                    })
                }
            })


			// 复选框样式
			$('.skin-minimal input').iCheck({
				checkboxClass: 'icheckbox-blue',
				radioClass: 'iradio-blue',
				increaseArea: '20%'
			});


			// 文章摘要
			$(".textarea-article").Huitextarealength({
				minlength: 10,
				maxlength: 500
			});

			// 文章内容 实例化百度富文本编辑器
			var ue = UE.getEditor('articleEditor');
			var str='{$list.content}';
			ue.ready(function() {
				ue.setContent(str.replace(/'/g, '"'));
		    });

			// 表单提交验证
			$("#form-article-add").validate({
				rules: {
					articleTitle: {
						required: true,
					},
					articleClassify: {
						required: true,
					},
					articleType: {
						required: true,
					},
					articlesStatus: {
						required: true,
					},

					articleAbstract: {
						required: true,
						minlength: 10,
						maxlength: 500
					},
				},
				onkeyup: false,
				focusCleanup: true,
				success: "valid",
				submitHandler: function(form){

					$("#classifyID").attr("disabled", false);
			        if ($("#classifyID").val() > 1 && $("#statusifyIDs").val() == 0) {
			          layer.msg('请选择分类');
			          return;
			        }
					$(form).ajaxSubmit({
						url: "{:url('Article/article_edit_s')}",
			            type: 'post',
			            dataType: 'json',
			            beforeSubmit: function () {},
			            success: function (data) {
			                if (data.code==200) {
			                	layer.msg(data.msg, {icon: 1,shade: 0.01,time:2000},function(){
	                             top.location.reload();

	                            });
			                }else{
			                	layer.msg(data.msg);
			                }
			            },
			            clearForm: false,//禁止清楚表单
			            resetForm: false //禁止重置表单

					});
				}
			});
		});
	</script>
	<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>
